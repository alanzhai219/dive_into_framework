<mxfile host="app.diagrams.net" modified="2024-01-12T02:30:11.894Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0" etag="gJavOA5aQBzrUIF-wpFd" version="22.1.16" type="github">
  <diagram name="第 1 页" id="u9nlI9UDKSe-epsc9CJU">
    <mxGraphModel dx="1923" dy="1957" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="2aWC7CVu05iSGpobY7B--2" value="PDPD&lt;br&gt;quantized model" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="240" y="40" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--3" value="ONNX&lt;br&gt;quantized model" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--4" value="ONNX FE&lt;br&gt;OP mapping" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--7" value="Quantization&lt;br&gt;pass" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="360" width="320" height="80" as="geometry" />
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--9" value="PDPD FE&lt;br&gt;OP mapping" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="240" y="120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--10" value="part of pass" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;gradientColor=none;fillStyle=dots;" vertex="1" parent="1">
          <mxGeometry x="240" y="360" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--11" value="hardware" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="480" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--12" value="PDPD FE &lt;br&gt;custom pass" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="240" y="200" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--15" value="fit quantized&lt;br&gt;patternA" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="40" y="280" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--17" value="fit quantized&lt;br&gt;patternB" style="ellipse;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fillStyle=auto;" vertex="1" parent="1">
          <mxGeometry x="240" y="280" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--18" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="2aWC7CVu05iSGpobY7B--4" target="2aWC7CVu05iSGpobY7B--15">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-180" y="220" as="sourcePoint" />
            <mxPoint x="-130" y="170" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--19" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="2aWC7CVu05iSGpobY7B--12" target="2aWC7CVu05iSGpobY7B--17">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-110" y="380" as="sourcePoint" />
            <mxPoint x="-60" y="330" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--20" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.188;entryY=-0.012;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="2aWC7CVu05iSGpobY7B--15" target="2aWC7CVu05iSGpobY7B--7">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-180" y="350" as="sourcePoint" />
            <mxPoint x="-130" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--22" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.815;entryY=0.008;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="2aWC7CVu05iSGpobY7B--17" target="2aWC7CVu05iSGpobY7B--7">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="420" y="390" as="sourcePoint" />
            <mxPoint x="470" y="340" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--23" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="2aWC7CVu05iSGpobY7B--7" target="2aWC7CVu05iSGpobY7B--11">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-100" y="430" as="sourcePoint" />
            <mxPoint x="-50" y="380" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--24" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="2aWC7CVu05iSGpobY7B--3" target="2aWC7CVu05iSGpobY7B--4">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-150" y="220" as="sourcePoint" />
            <mxPoint x="-100" y="170" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--25" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="2aWC7CVu05iSGpobY7B--2" target="2aWC7CVu05iSGpobY7B--9">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-170" y="240" as="sourcePoint" />
            <mxPoint x="-120" y="190" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--26" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="2aWC7CVu05iSGpobY7B--9" target="2aWC7CVu05iSGpobY7B--12">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-70" y="230" as="sourcePoint" />
            <mxPoint x="-20" y="180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--27" value="&lt;div&gt;Reason:&lt;/div&gt;&lt;ol&gt;&lt;li&gt;In order to match the Quantization pass, we should prepare the specific patterns.&lt;/li&gt;&lt;li&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;pattern after ONNX FE OP mapping can meet the requirement. As a result, it can take most use of quantization pass.&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;but pattern after PDPD FE op mapping is a bit far way from specific pattern because of some PDPD FE op mapping mechanism limits. So, I create a custom pass as a midware to meet the next quantization pass need. However, the custom in PDPD FE just does what common quantization pass do and patternB just match or take use of part of common quantization pass.&lt;/span&gt;&lt;/li&gt;&lt;/ol&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Next:&lt;br&gt;&lt;ul&gt;&lt;li&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;As you have seen, patternA after ONNX FE and patternB after PDPD FE are different. It means that patternB dose N&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;OT take most use of common quantization pass. So, we just figure out how to prepare the patternB like patternA.&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;way1: remove the PDPD FE custom and modify the PDPD FE mapping to prepare the patternB like patternA directly.&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;way2: modify the PDPD FE custom pass to prepare the patternB like patternA..&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/span&gt;" style="shape=callout;whiteSpace=wrap;html=1;perimeter=calloutPerimeter;align=left;" vertex="1" parent="1">
          <mxGeometry x="-460" y="-170" width="450" height="350" as="geometry" />
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--28" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;exitX=1;exitY=0;exitDx=0;exitDy=0;" edge="1" parent="1" source="2aWC7CVu05iSGpobY7B--15">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-40" y="270" as="sourcePoint" />
            <mxPoint x="-235" y="180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2aWC7CVu05iSGpobY7B--29" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;exitX=0;exitY=0;exitDx=225;exitDy=350;exitPerimeter=0;" edge="1" parent="1" source="2aWC7CVu05iSGpobY7B--27" target="2aWC7CVu05iSGpobY7B--17">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-90" y="340" as="sourcePoint" />
            <mxPoint x="-40" y="290" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
